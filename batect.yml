project_name: batect.dev

tasks:
  setup:
    description: Install dependencies.
    group: Setup tasks
    run:
      container: node-build-env
      command: yarn install

  shell:
    description: Start a shell in the build environment.
    group: Utility tasks
    run:
      container: node-build-env
      command: bash

  build:
    description: Build the site.
    group: Build tasks
    run:
      container: node-build-env
      command: yarn build

  build-local:
    description: Build a production-like version of the site suitable for local serving.
    group: Build tasks
    run:
      container: node-build-env
      command: yarn build --out-dir build-local
      environment:
        SITE_URL: http://0.0.0.0:3000

  serve:
    description: Serve a production build of the site.
    group: Testing tasks
    prerequisites:
      - build-local
    run:
      container: node-build-env
      command: yarn serve --dir build-local --host 0.0.0.0
      ports:
        - local: 3000
          container: 3000

  check-format:
    description: Check for formatting issues.
    group: Linting and formatting tasks
    run:
      container: node-build-env
      command: yarn checkFormat

  fix-format:
    description: Fix formatting issues.
    group: Linting and formatting tasks
    run:
      container: node-build-env
      command: yarn fixFormat

  lint:
    description: Check for linting issues.
    group: Linting and formatting tasks
    run:
      container: node-build-env
      command: yarn lint

  fix-lint:
    description: Fix linting issues.
    group: Linting and formatting tasks
    run:
      container: node-build-env
      command: yarn lintFix

  start:
    description: Start the site locally.
    group: Testing tasks
    run:
      container: node-build-env
      command: yarn start --host 0.0.0.0
      ports:
        - local: 3000
          container: 3000

include:
  - type: git
    repo: https://github.com/batect/node-bundle.git
    ref: 0.2.0
